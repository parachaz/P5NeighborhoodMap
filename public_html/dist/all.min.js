function MapMarker(e,n,t,o){var a=this;a.id=e,a.title=n,a.description=ko.observable(),a.selected=ko.observable(!1),a.lat=t,a.lng=o,a.formatteID=ko.computed(function(){return a.id+".Â "},this),a.latLng=new google.maps.LatLng(t,o),a.iconColor=ko.observable("|FFF000|000000"),a.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+e+a.iconColor(),a.marker=new google.maps.Marker({position:a.latLng,title:n,icon:"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+e+"|FF0000|000000"}),a.marker.setMap(map),google.maps.event.addListener(a.marker,"click",function(){return a.selected()===!0?(infoWindow.close(),void a.selected(!1)):(selectedMarker&&selectedMarker.selected(!1),a.selected(!0),selectedMarker=a,infoWindow.setContent("<h2>"+a.id+". "+a.title+"</h2>"+a.description()),infoWindow.open(map,this),void map.panTo(a.marker.position))}),a.openInfoWindow=function(){google.maps.event.trigger(a.marker,"click")},google.maps.event.addListener(infoWindow,"closeclick",function(){a.selected(!1)})}function MapMarkerViewModel(){var e=this;e.markers=ko.observableArray(),e.loadMarkerDecription=function(e){"undefined"==typeof e.description()&&(wikiURL="http://api.geonames.org/findNearbyWikipediaJSON?formatted=true&lat="+e.lat+"&lng="+e.lng+"&username=parachaz&style=full",$.ajax({url:wikiURL,dataType:"jsonp",success:function(n){e.description(n.geonames[0].summary)}})),e.description()&&e.openInfoWindow()},$.getJSON("js/mapMarkers.json",function(n){for(var t=1,o=$.map(n,function(e){return e}),a=0;a<o.length;a++){var r=new MapMarker(t++,o[a].title,o[a].lat,o[a].lng);e.markers.push(r)}}),e.map=map,e.searchField=ko.observable(""),e.filterMarkers=function(n){var t=!1,o=new RegExp(e.searchField(),"i"),a=n.title,r=o.test(a);return r?(n.marker.setMap(map),t=!0):n.marker.setMap(null),t},e.styling=function(e){return e.selected()===!0?"selected":""},google.maps.event.addListener(map,"click",function(){infoWindow.close(),console.log(e.markers().length);for(var n=0;n<e.markers().length;n++)e.markers()[n].selected(!1)})}function initializeMap(){var e={center:new google.maps.LatLng(40.759094,-73.985136),zoom:12};map=new google.maps.Map(document.getElementById("map-canvas"),e)}var map,infoWindow=new google.maps.InfoWindow,selectedMarker;$(document).ready(function(){var e=function(){"up"===Offline.state&&Offline.check()};initializeMap(),ko.applyBindings(new MapMarkerViewModel),setInterval(e,5e3)});